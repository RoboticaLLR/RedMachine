// Declaración de Librerias
#include <Servo.h>
#include "Adafruit_TCS34725.h"
Adafruit_TCS34725 tcs =
Adafruit_TCS34725(TCS34725_INTEGRATIONTIME_50MS, TCS34725_GAIN_1X);

Servo pro;
int d = 16; // Distancia ultrasonido izquierdo
int a = 0;
int giro = 0 ;
int rec= 103; // Varor del servo para avarzar dececho
int da=16; // Distancia ultrasonido derecho
int t; // ultrasonido tiempo de rebote izquierdo
int te; // ultrasonido tiempo de rebote derecho
int vel= 83;
int gi=vel+20;

void setup()
{
  pinMode(0, OUTPUT);
  pinMode(1, OUTPUT);
  pinMode(2, OUTPUT);
  pinMode(3, OUTPUT);
  pinMode(4, OUTPUT);
  pinMode(5, OUTPUT);
  pinMode(6, OUTPUT);
  pinMode(8, OUTPUT);
  pinMode(9, OUTPUT);
  pinMode(10, OUTPUT);// Trigger
  pinMode(11, INPUT);  //cho
  pinMode(12, OUTPUT); //Trigger
  pinMode(13, INPUT);  //Echo
  pinMode(22, OUTPUT);
  pro.attach(4);  // Pin de conwtrol del servo
  digitalWrite(22,HIGH);
  Serial.begin(9600);
  if(tcs.begin()){
    Serial.println("Inicializando");
    delay(2000);
  }
  else{
    Serial.println("Error");
    Serial.println("Debe de revisar las conexiones e iniciar nuevamente");
    while(1)delay(500);
  }
  pro.write(rec);
  delay(800);
  digitalWrite(8,HIGH);
  analogWrite(6,vel);
}

void loop() {
  //CALCULAR COLOR
  uint16_t R,G,B,C;
  tcs.getRawData(&R,&G,&B,&C);
  //DIRECCIONAR Y MOVER MOTORES

  //giro antihorario (Naranja)
  if((R>120)&&(B<160)&&(a==0)){
    a=2; 
  }

//detectar giro horario(Azul)
  if((R<120)&&(B<160)&&(a==0)){
a=1;
  }

  ping();
 //Hacer giro horario (azul)
   if((d<60)&&(a==1)){
    pro.write(70);
    analogWrite(6,gi);
    delay(700);
    pro.write(rec);
        analogWrite(6,vel);
    d=100;
    delay(1900);
    giro++;
  }

  //Hacer hiro antihorario(naranja)
  if((d<75)&&(a==2)){
    pro.write(140);
    analogWrite(6,gi);
    delay(700);
    pro.write(rec);
    analogWrite(6,vel);
    d=100;
    delay(2500);
    giro++;
  }
  
  //detectar 3 vueltas y detenerse
  if (giro == 12){
analogWrite(8,0);
a=40;
}
}

// Control del sensor de ultrasonido y cálculo de distancia
int ping() {
   digitalWrite(10, HIGH);
  delayMicroseconds(10);          //Enviamos un pulso de 10us
  digitalWrite(10, LOW);

  t = pulseIn(11, HIGH); //obtenemos el ancho del pulso
  d = t/59;
}
